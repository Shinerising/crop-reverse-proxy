version: '3'

networks:
  proxy:
    driver: bridge
  frontend:
    driver: bridge
    internal: true
  backend:
    driver: bridge
    internal: true

volumes:
  asset-dars:
  asset-dashboard:

services:
  proxy:
    image: ghcr.io/shinerising/crop-reverse-proxy:master
    restart: always
    volumes:
      - /volume1/docker/crop/nginx.conf:/etc/nginx/nginx.conf:ro
      - asset-dars:/usr/share/nginx/asset-dars:ro
      - asset-dashboard:/usr/share/nginx/asset-dashboard:ro
    ports:
      - "3380:80"
      - "33443:443"
    environment:
      - URL_DARS=dars:8376
      - URL_DASHBOARD=dashboard:7344
    networks:
      - proxy
      - frontend

  dars:
    image: ghcr.io/shinerising/station-stats:master
    restart: always
    volumes:
      - asset-dars:/App/public
      - /volume1/docker/station-stats/config:/config
      - /volume1/docker/station-stats/station:/station
      - /volume1/docker/station-stats/data:/data
    ports:
      - "8376:8376"
    environment:
      - SERVER_CONFIG=/config/server.xml
      - STATION_CONFIG=/config/station.xml
    networks:
      - frontend

  dashboard:
    image: ghcr.io/shinerising/crop-dashboard:main
    restart: always
    volumes:
      - asset-dashboard:/App/public
    ports:
      - "7344:80"
    tty: true
    networks:
      - frontend